# HTTPS

https是基于http进行的升级，在http的基础上加上SSL，保证传输的数据安全。

**对称加密**

https核心的是使用对称加密算法对传输数据内容进行加密，使用加密算法+（变量/盐），将明文加密成密文之后传输，只要保证变量/盐在传输过程中不被丢失窃取，那么就能保证HTTPS的安全性可靠。客户端随机生成变量/盐，至于怎么告诉服务端，这就是最重要的一个环节。（最常见的对称加密算法：des,3des,AES）

**非对称加密**

分为公钥和私钥，公钥由私钥生成。公钥加密，私钥解密；私钥加密，公钥解密；但是公钥加密是无法使用公钥解密，私钥加密可以使用私钥解密。

服务器端由私钥生成公钥，然后下发公钥给客户端，但是只是这样，在传输中途，会被中间商获得公钥，然后再将公钥下发给客户端。虽然，客户端使用公钥加密内容，中间商无法解密，但是，中间商可以使用公钥加密一份假数据发送给服务端，数据返回时，也可以制作一份假的公钥私钥，然后将假数据和公钥一起发给客户端，所以这样同样是不安全的。造成这一问题是，客户端无法判断自己得到的公钥是不是真的。

**摘要算法（hash算法）**

该算法接受到的对象，得到的结果是无法反推的。无论对象有多长，生成的结果都是固定长度；而且相同的对象，结果也是一样的。

因此，可以利用这个进行数据签名，如果对公钥进行加密，就可以避免服务端得到假公钥加密的数据。但依然有问题

**第三方机构**

第三方机构使用自己的私钥加密服务的公钥=密文，hash服务端的公钥=签名，摘要算法，这三者加起来=证书，然后下发证书给客户端，而第三方的公钥是内嵌在操作系统中的。

客户端拿到证书后，用第三方公钥得到服务端公钥，然后再用摘要算法计算服务端公钥，对比签名，如果不一样，说明服务端公钥被篡改了。

- 如果在这条件下，中间商只能使用自己的私钥加密一个证书发给客户端，但是客户端是不承认中间商的公钥，只会认同第三方机构的，客户端这边自带第三方公钥。

  问题：虽然这样可以避免了中间商篡改数据，但数据还是会被偷看，所以在这情况下需要再升级。

  `实际方案：在进行https请求的时候，会先请求服务器端的443端口，然后再请求服务器的80端口。在443端口会发生4步操作`

  1. 客户端向服务器请求，告诉服务器自己支持的对称加密算法有哪些；
  2. 服务器向客户端下发证书，如果服务器不支持客户端的算法，就不会下发证书；
  3. 客户端随机生成随机数（变量/盐），使用服务端下发的公钥进行加密，发送给服务器（这里中间商是获取不到这个随机数的）
  4. 服务器回复ok。

> ## 注：这些都是为保护的对称加密的秘钥